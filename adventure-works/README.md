# adventure-works

Sample database for [Adventure Works](https://learn.microsoft.com/en-us/sql/samples/adventureworks-install-configure?view=sql-server-ver16&tabs=tsql).

This repository containes the following.

1. ER diagram of the Adventure Works database.
   - [tbls](./tbls)
     - Generated by [tbls](https://github.com/k1LoW/tbls)
   - [schemaspy](./schemaspy)
     - Generated by [SchemaSpy](https://github.com/schemaspy/schemaspy)
1. JSON file of the Adventure Works database.
   - [exports](./exports)

## Quick Start

```sh
make init

# start sql server in local
make db/start

# restore Adventure Works database
make db/restore

# generate ER diagram
make db/generate_er_diagram

# export Adventure Works database to JSON
make db/export_json
```

## Import data to BigQuery

1. Create a dataset in BigQuery.

   ```sh
   bq --project_id [PROJECT_ID] --location us mk adventure_works
   ```

1. Import JSON files to Cloud Storage

   ```sh
   gcloud storage cp './exports/*' gs://[BUCKET_NAME]/adventure-works/
   ```

1. Load JSON files to BigQuery

   ```sh
   for f in $(gcloud storage ls gs://[BUCKET_NAME]/adventure-works/); do
     name=$(echo ${f} | awk -F/ '{print $(NF-0)}' | sed 's/\..*$//')
     bq load \
       --project_id [PROJECT_ID] \
       --location=us \
       --source_format=NEWLINE_DELIMITED_JSON \
       --autodetect \
       adventure_works.${name} \
       gs://[BUCKET_NAME]/adventure-works/${name}.jsonl
   done
   ```
